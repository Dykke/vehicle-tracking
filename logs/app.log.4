2025-11-26 17:43:24,767 - app - DEBUG - Sent vehicle positions to client: zOugCjD_asS4WwugAAAc
2025-11-26 17:43:55,974 - app - DEBUG - Client disconnected: zOugCjD_asS4WwugAAAc
2025-11-26 17:44:01,212 - app - DEBUG - Client connected: D5W1p9ODYXHtgmLSAAAe
2025-11-26 17:44:01,213 - app - DEBUG - User 2 joined room: user_2
2025-11-26 17:44:12,485 - app - DEBUG - Client disconnected: D5W1p9ODYXHtgmLSAAAe
2025-11-26 17:44:14,805 - app - DEBUG - Client connected: MC_9Zxqik3C0CWHQAAAg
2025-11-26 17:44:14,910 - app - DEBUG - Vehicle positions cache updated with 1 vehicles
2025-11-26 17:44:14,911 - app - DEBUG - Sent vehicle positions to client: MC_9Zxqik3C0CWHQAAAg
2025-11-26 17:44:55,677 - app - DEBUG - Client disconnected: MC_9Zxqik3C0CWHQAAAg
2025-11-26 17:45:00,066 - app - DEBUG - Client connected: aGOgr8sUzhY4H3bHAAAi
2025-11-26 17:45:00,070 - app - DEBUG - User 2 joined room: user_2
2025-11-26 17:46:00,164 - app - DEBUG - Client disconnected: aGOgr8sUzhY4H3bHAAAi
2025-11-26 17:46:02,922 - app - DEBUG - Client connected: g7mTn1GGWtbgJLpCAAAk
2025-11-26 17:46:03,035 - app - DEBUG - Vehicle positions cache updated with 0 vehicles
2025-11-26 17:46:03,037 - app - DEBUG - Sent vehicle positions to client: g7mTn1GGWtbgJLpCAAAk
2025-11-26 17:46:04,037 - app - DEBUG - Client disconnected: g7mTn1GGWtbgJLpCAAAk
2025-11-26 17:46:19,262 - app - ERROR - Error emitting assignment change: 'Request' object has no attribute 'namespace'
2025-11-26 17:46:34,693 - app - ERROR - Error emitting assignment change: 'Request' object has no attribute 'namespace'
2025-11-26 17:46:51,078 - app - DEBUG - Client connected: 2pNAKcgm63nG1uMbAAAm
2025-11-26 17:46:51,178 - app - DEBUG - Vehicle positions cache updated with 0 vehicles
2025-11-26 17:46:51,179 - app - DEBUG - Sent vehicle positions to client: 2pNAKcgm63nG1uMbAAAm
2025-11-26 17:46:51,532 - app - DEBUG - Client disconnected: 2pNAKcgm63nG1uMbAAAm
2025-11-26 17:46:57,513 - app - DEBUG - Client connected: nNGozvkLW09WxXXjAAAo
2025-11-26 17:46:57,515 - app - DEBUG - User 2 joined room: user_2
2025-11-26 17:47:02,795 - app - ERROR - Exception on /driver/vehicle/2/details [GET]
Traceback (most recent call last):
  File "C:\Users\veesa\AppData\Local\Programs\Python\Python313\Lib\site-packages\flask\app.py", line 1455, in wsgi_app
    response = self.full_dispatch_request()
  File "C:\Users\veesa\AppData\Local\Programs\Python\Python313\Lib\site-packages\flask\app.py", line 869, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "C:\Users\veesa\AppData\Local\Programs\Python\Python313\Lib\site-packages\flask_cors\extension.py", line 176, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
                                                ~^^^^^^^^^^^^^^^^^
  File "C:\Users\veesa\AppData\Local\Programs\Python\Python313\Lib\site-packages\flask\app.py", line 867, in full_dispatch_request
    rv = self.dispatch_request()
  File "C:\Users\veesa\AppData\Local\Programs\Python\Python313\Lib\site-packages\flask\app.py", line 852, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
  File "C:\Users\veesa\AppData\Local\Programs\Python\Python313\Lib\site-packages\flask_login\utils.py", line 290, in decorated_view
    return current_app.ensure_sync(func)(*args, **kwargs)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "C:\Users\veesa\OneDrive\Documents\GitHub\drive-monitoring\drive-monitoring\routes\driver.py", line 143, in get_vehicle_details
    'last_location_update': vehicle.last_location_update.isoformat() if vehicle.last_location_update else None
                                                                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'Vehicle' object has no attribute 'last_location_update'
2025-11-26 17:47:04,827 - app - ERROR - Error emitting vehicle update: 'Request' object has no attribute 'namespace'
2025-11-26 17:47:06,585 - app - ERROR - Exception on /driver/vehicle/2/details [GET]
Traceback (most recent call last):
  File "C:\Users\veesa\AppData\Local\Programs\Python\Python313\Lib\site-packages\flask\app.py", line 1455, in wsgi_app
    response = self.full_dispatch_request()
  File "C:\Users\veesa\AppData\Local\Programs\Python\Python313\Lib\site-packages\flask\app.py", line 869, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "C:\Users\veesa\AppData\Local\Programs\Python\Python313\Lib\site-packages\flask_cors\extension.py", line 176, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
                                                ~^^^^^^^^^^^^^^^^^
  File "C:\Users\veesa\AppData\Local\Programs\Python\Python313\Lib\site-packages\flask\app.py", line 867, in full_dispatch_request
    rv = self.dispatch_request()
  File "C:\Users\veesa\AppData\Local\Programs\Python\Python313\Lib\site-packages\flask\app.py", line 852, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
  File "C:\Users\veesa\AppData\Local\Programs\Python\Python313\Lib\site-packages\flask_login\utils.py", line 290, in decorated_view
    return current_app.ensure_sync(func)(*args, **kwargs)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "C:\Users\veesa\OneDrive\Documents\GitHub\drive-monitoring\drive-monitoring\routes\driver.py", line 143, in get_vehicle_details
    'last_location_update': vehicle.last_location_update.isoformat() if vehicle.last_location_update else None
                                                                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'Vehicle' object has no attribute 'last_location_update'
2025-11-26 17:47:12,885 - app - DEBUG - Client disconnected: nNGozvkLW09WxXXjAAAo
2025-11-26 17:47:14,963 - app - DEBUG - Client connected: iXK9_L4Aqos2E1RMAAAq
2025-11-26 17:47:15,061 - app - DEBUG - Vehicle positions cache updated with 1 vehicles
2025-11-26 17:47:15,062 - app - DEBUG - Sent vehicle positions to client: iXK9_L4Aqos2E1RMAAAq
2025-11-26 17:49:03,983 - app - INFO - Flask app using database: sqlite:///app.db
2025-11-26 17:49:03,984 - app - INFO - Database directory exists: C:\Users\veesa\OneDrive\Documents\GitHub\drive-monitoring\drive-monitoring
2025-11-26 17:49:04,047 - app - INFO - BYPASSING migrations and using safe table creation...
2025-11-26 17:49:04,047 - app - INFO - Models imported successfully
2025-11-26 17:49:04,048 - app - INFO - Database file path: C:\Users\veesa\OneDrive\Documents\GitHub\drive-monitoring\drive-monitoring\app.db
2025-11-26 17:49:04,048 - app - INFO - Database file exists: True
2025-11-26 17:49:04,048 - app - INFO - Database file size: 73728 bytes
2025-11-26 17:49:04,051 - app - INFO - Existing tables: ['driver_action_logs', 'location_logs', 'notification_settings', 'notifications', 'operator_action_logs', 'passenger_events', 'trips', 'users', 'vehicles']
2025-11-26 17:49:04,051 - app - INFO - Database exists with data, skipping table creation to preserve data
2025-11-26 17:49:04,051 - app - INFO - All required tables exist ✓
2025-11-26 17:49:04,052 - app - INFO - Final tables: ['driver_action_logs', 'location_logs', 'notification_settings', 'notifications', 'operator_action_logs', 'passenger_events', 'trips', 'users', 'vehicles']
2025-11-26 17:49:04,052 - app - INFO - Ensuring required columns exist in vehicles table...
2025-11-26 17:49:04,053 - app - INFO - Existing columns in vehicles table: ['id', 'registration_number', 'vehicle_type', 'capacity', 'status', 'created_at', 'occupancy_status', 'last_speed_kmh', 'current_latitude', 'current_longitude', 'last_updated', 'accuracy', 'route', 'route_info', 'owner_id', 'assigned_driver_id']
2025-11-26 17:49:04,053 - app - INFO - Column accuracy already exists
2025-11-26 17:49:04,053 - app - INFO - Column route already exists
2025-11-26 17:49:04,054 - app - INFO - Column route_info already exists
2025-11-26 17:49:04,054 - app - INFO - Column check completed
2025-11-26 17:49:04,054 - app - INFO - VERIFICATION - Vehicle columns after setup: ['id', 'registration_number', 'vehicle_type', 'capacity', 'status', 'created_at', 'occupancy_status', 'last_speed_kmh', 'current_latitude', 'current_longitude', 'last_updated', 'accuracy', 'route', 'route_info', 'owner_id', 'assigned_driver_id']
2025-11-26 17:49:04,054 - app - INFO - ALL REQUIRED COLUMNS VERIFIED ✓
2025-11-26 17:49:04,054 - app - INFO - Checking for name fields in users table...
2025-11-26 17:49:04,055 - app - INFO - ✓ All name fields already exist in users table
2025-11-26 17:49:04,538 - app - DEBUG - Client connected: qUy7mXfwj-h3vJ0IAAAB
2025-11-26 17:49:04,646 - app - DEBUG - Vehicle positions cache updated with 1 vehicles
2025-11-26 17:49:04,648 - app - DEBUG - Sent vehicle positions to client: qUy7mXfwj-h3vJ0IAAAB
2025-11-26 17:49:05,646 - app - DEBUG - Client disconnected: qUy7mXfwj-h3vJ0IAAAB
2025-11-26 17:49:07,742 - app - DEBUG - Client connected: wbFPsjmfZ4RTUQWUAAAD
2025-11-26 17:49:07,854 - app - DEBUG - Sent vehicle positions to client: wbFPsjmfZ4RTUQWUAAAD
2025-11-26 17:49:10,507 - app - DEBUG - Client disconnected: wbFPsjmfZ4RTUQWUAAAD
2025-11-26 17:49:15,561 - app - DEBUG - Client connected: 1vdUP59i6NBWspomAAAF
2025-11-26 17:49:15,591 - app - DEBUG - User 2 joined room: user_2
2025-11-26 17:49:19,882 - app - DEBUG - Client disconnected: 1vdUP59i6NBWspomAAAF
2025-11-26 17:49:21,945 - app - DEBUG - Client connected: dcrkCZa0ZFSa4RWZAAAH
2025-11-26 17:49:22,166 - app - DEBUG - Vehicle positions cache updated with 1 vehicles
2025-11-26 17:49:22,168 - app - DEBUG - Sent vehicle positions to client: dcrkCZa0ZFSa4RWZAAAH
2025-11-26 17:52:33,366 - app - DEBUG - Client disconnected: dcrkCZa0ZFSa4RWZAAAH
2025-11-26 17:52:38,244 - app - DEBUG - Client connected: q0Zi0XZ9Z1Wxl88aAAAJ
2025-11-26 17:52:38,248 - app - DEBUG - User 2 joined room: user_2
